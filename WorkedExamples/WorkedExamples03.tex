\documentclass[12pt, xcolor=dvipsnames,svgnames,x11names]{article}
\usepackage{xcolor}
%\usepackage{universityos}
\usepackage{xspace}
\usepackage{url}
\usepackage[colorlinks=true,bookmarks=false,linkcolor=black,urlcolor=blue,citecolor=black]{hyperref}
\usepackage{fancyhdr}
\usepackage[top=1in,bottom=1in,left=1in,right=1in]{geometry}
\usepackage{multicol}
\usepackage{pgfplots}
\usetikzlibrary{circuits.logic.US}
% \usepackage{tgschola}
\let\temp\rmdefault
\usepackage{mathpazo}
\let\rmdefault\temp

\definecolor{roseRed}{HTML}{e20047}
\definecolor{coolGray}{HTML}{474747} % Neutral gray to contrast roseRed
\definecolor{mocha}{HTML}{a47864}
\definecolor{sage}{HTML}{8a9a5b}
\definecolor{dustyblue}{HTML}{6e8ca0}
\definecolor{terracotta}{HTML}{c87f5b}
\definecolor{lavender}{HTML}{9d8bb0}
\definecolor{darkmocha}{HTML}{7a5a4b}
\definecolor{darksage}{HTML}{667244}
\definecolor{darkdustyblue}{HTML}{526878}
\definecolor{darkterracotta}{HTML}{9e6347}
\definecolor{darklavender}{HTML}{766688}
\definecolor{winery}{HTML}{7e212a}

\definecolor{lightmocha}{HTML}{c2a190}
\definecolor{lightmocha1}{HTML}{d1b09c}
\definecolor{lightmocha2}{HTML}{e2c4b0}
\definecolor{lightmocha3}{HTML}{f0d9c7}

\definecolor{androidBlue}{HTML}{8AB4F8}
\definecolor{androidBlueLight}{HTML}{E8F0FE}
\definecolor{androidGreen}{HTML}{81C995}
\definecolor{androidGreenLight}{HTML}{E6F4EA}

% Red variants - based on Android's "error" and warning colors
\definecolor{androidRed}{HTML}{F28B82}
\definecolor{androidRedLight}{HTML}{FADAD7}

% Yellow variants - based on Android's accent/warning colors
\definecolor{androidYellow}{HTML}{FDD663}
\definecolor{androidYellowLight}{HTML}{FEF7E0}

% Purple variants - based on Android's system UI accents
\definecolor{androidPurple}{HTML}{D7AEFB}
\definecolor{androidPurpleLight}{HTML}{F4EAFC}

% Orange variants - based on Android's notification colors
\definecolor{androidOrange}{HTML}{FCAD70}
\definecolor{androidOrangeLight}{HTML}{FEEADC}

% Teal variants - based on Android's Material You palette
\definecolor{androidTeal}{HTML}{78D9EC}
\definecolor{androidTealLight}{HTML}{E6F6F9}

% Gray variants - based on Android's neutral colors
\definecolor{androidGray}{HTML}{DADCE0}
\definecolor{androidGrayLight}{HTML}{F1F3F4}


\usepackage{biolinum} % included with the {Libertine} font package
\renewcommand{\familydefault}{\sfdefault}



\usepackage[many]{tcolorbox}
\usepackage{CJKutf8}

% Redefine \maketitle to include tcolorbox
\makeatletter
\renewcommand{\maketitle}{%
    \begin{center}
        \begin{tcolorbox}[
            enhanced,
            colback=white,
            colframe=red!70!black,
            arc=0mm,
            title={\textcolor{white}{\bfseries CPE 221 \@title}},
            coltitle=white,
            fonttitle=\bfseries\large,
            attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
            boxed title style={
            sharp corners,
            colback=red!70!black,
            frame hidden,
            boxrule=0pt,
            left=10pt, right=10pt,
            top=3pt, bottom=3pt
            }
        ]
        \large
        \vspace{10pt}
        \noindent \@author
    \end{tcolorbox}
    \end{center}
}
\makeatother

\setlength{\parindent}{0pt}
\setlength{\parskip}{4pt}%

\input{../Classwork/common}

\newcommand{\hw}{Worked Examples: Machine Code in ARM}
\newcommand{\duedate}{March 17, 2025}
\newcommand{\hwturnin}{cw11}

% Add showanswer toggle (set to "yes" for solutions, anything else for student version)
\usepackage{ifthen}
\newcommand{\showanswer}{no}

\newenvironment{multiequation}[1][]{%
    \begin{equation}%
    \begin{aligned}%
        \ifx#1\@empty\else\label{#1}\fi%
}{%
    \end{aligned}%
\end{equation}% 
}
\pagestyle{fancy}

\lhead{\footnotesize{\coursenumber, \courseterm}, \footnotesize{The University of Alabama in Huntsville}}
\chead{}
\rhead{\footnotesize{\emph{\hw}}}
\lfoot{\footnotesize{\instructorname}}
\cfoot{\footnotesize{\thepage}}
\rfoot{\footnotesize{\textit{Last Revised:~\today}}}
\renewcommand{\headrulewidth}{0.1pt}
\renewcommand{\footrulewidth}{0.1pt}
\newcommand{\minipagewidth}{0.8\columnwidth}

\renewcommand{\thefootnote}{\fnsymbol{footnote}}


\renewcommand{\headrulewidth}{0.1pt}
\renewcommand{\footrulewidth}{0.1pt}

\renewcommand{\thefootnote}{\fnsymbol{footnote}}

\usepackage{mdframed} 


\begin{document}


\title{\textsc{\hw}}
\author{Instructor: \instructorname}

\maketitle


\section{Decode Data-Processing Instruction}
 Decode the ARM instruction \texttt{0xE0831002} into its assembly language form.

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \texttt{ADD R1, R3, R2}
\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \begin{itemize}
        \item op code (27-26): \texttt{00} indicates a data-processing instruction
        \item funct (25-20): \texttt{0 0100 0} where bits 24-21 are \texttt{0100} which is the ADD operation
        \item Rn (19-16): \texttt{0011} = R3 (first source register)
        \item Rd (15-12): \texttt{0001} = R1 (destination register)
        \item Src2 (11-0): \texttt{000000000010} = R2 (second source register)
    \end{itemize}
\end{tcolorbox}

\section{Identify Conditional Execution}
 What is the condition code for the instruction \texttt{0x1A000003} and what does it mean?

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    Condition code is \texttt{0001} (NE), meaning ``Not Equal''.
\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \begin{itemize}
        \item Condition code is in bits 31-28: \texttt{0001}
        \item According to the ARM condition codes, \texttt{0001} corresponds to NE (Not Equal)
        \item This instruction will execute only if the Z flag is not set (Z=0)
        \item The full instruction is a branch instruction (BNE) that branches if the result is not equal
    \end{itemize}
\end{tcolorbox}

\section{Decode Memory Instruction}
 Decode the machine code \texttt{0xE5845000} into its assembly form.

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \texttt{STR R5, [R4]}
\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \begin{itemize}
        \item op code (27-26): \texttt{01} indicates a memory instruction
        \item L bit (20): \texttt{0} indicates store (STR)
        \item Rn (19-16): \texttt{0100} = R4 (base register)
        \item Rd (15-12): \texttt{0101} = R5 (source register to be stored)
        \item P bit (24): \texttt{1} indicates pre-indexing
        \item U bit (23): \texttt{1} indicates addition
        \item Offset (11-0): \texttt{000000000000} = 0 (no offset)
    \end{itemize}
\end{tcolorbox}

\section{Encode ADD Instruction}
 Encode the assembly instruction \texttt{ADD R7, R2, R3, LSL \#2} into machine code.

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \texttt{0xE0827103}
\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
    \begin{itemize}
        \item Cond (31-28): \texttt{1110} (AL - Always execute)
        \item Op (27-26): \texttt{00} (data-processing)
        \item Funct (25-20): \texttt{001000} (ADD operation, I=0, S=0)
        \item Rn (19-16): \texttt{0010} (R2)
        \item Rd (15-12): \texttt{0111} (R7)
        \item Shift (11-4): \texttt{0001 0000} (LSL \#2)
        \item Rm (3-0): \texttt{0011} (R3)
    \end{itemize}

\end{tcolorbox}


\section{Identify Immediate Value}


What is the immediate value in the instruction \texttt{0xE2851014}?

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
The immediate value is \texttt{20} (decimal).
\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]

\begin{itemize}
    \item This is a data-processing instruction with I=1 (immediate)
    \item The immediate field is in bits 7-0: \texttt{00010100} = 0x14 = 20 decimal
\item The rotation field (bits 11-8) is \texttt{0000}, meaning no rotation
   \item The instruction is ADD R1, R5, \#20 (adding immediate value 20 to R5)
\end{itemize}


\end{tcolorbox}

\section{Calculate Branch Target Address}

If the instruction at address 0x8400 is \texttt{0xEA000005}, what is the branch target address?

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
The branch target address is \texttt{0x841C}.


\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]

\begin{itemize}
    \item This is an unconditional branch (B) instruction
    \item The immediate field is 5
\item Branch target = PC+8 + (imm24 Ã— 4)
\item PC+8 for the instruction at 0x8400 is 0x8408
\item 5 $\times$ 4 = 20 (0x14)
\item 0x8408 + 0x14 = 0x841C
\end{itemize}


\end{tcolorbox}

\section{Decode STR Instruction with Offset}

Decode the machine code \texttt{0xE5073018} into its assembly form.

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
STR R3, [R7, \#-24]

\end{tcolorbox}

\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]

\begin{itemize}
    \item op code (27-26): \texttt{01} indicates a memory instruction
    \item L bit (20): \texttt{0} indicates store (STR)
\item Rn (19-16): \texttt{0111} = R7 (base register)
\item Rd (15-12): \texttt{0011} = R3 (source register)
\item P bit (24): \texttt{1} indicates pre-indexing
\item U bit (23): \texttt{0} indicates subtraction
\item Offset (11-0): \texttt{000000011000} = 24 decimal
\item The negative sign comes from U=0 (subtraction)
\end{itemize}

\end{tcolorbox}

\section{Identify Function Code}
What operation is performed by the instruction \texttt{0xE0413002}?

\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
This is a SUB instruction that performs subtraction.

\end{tcolorbox}


\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]

\begin{itemize}
    \item op code (27-26): \texttt{00} indicates a data-processing instruction.
    \item funct (24-21): \texttt{0100} corresponds to SUB operation.
    \item The instruction subtracts R2 from R1 and stores the result in R3
\end{itemize}

\end{tcolorbox}

\section{Decode Load Multiple Instruction}
Decode the machine code \texttt{0xE92D4030} into its assembly form.



\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
PUSH \{R4, R5, LR\}

\end{tcolorbox}


\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]

\begin{itemize}
    \item This is a STMFD instruction (Store Multiple Full Descending)
    \item Register list (bits 15-0): \texttt{0100000000110000} sets bits 4, 5, and 14
    \item So registers R4, R5, and LR (R14) are being stored
    \item Base register (bits 19-16): \texttt{1101} = R13 (SP)
    \item When SP is the base register with writeback, this is equivalent to the PUSH instruction
\end{itemize}

\end{tcolorbox}

\section{Encode Conditional Execution}

Encode the assembly instruction \texttt{ADDEQ R0, R1, R2} into machine code.


\begin{tcolorbox}[
    enhanced,
    colback=androidBlueLight,
    colframe=androidBlue,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Solution},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidBlue,    
        colframe=androidBlue,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]
\texttt{0x00810002}

\end{tcolorbox}


\begin{tcolorbox}[
    enhanced,
    colback=androidGreenLight,
    colframe=androidGreen,
    arc=5pt,
    boxrule=1pt,
    title=\textbf{Explanation},
    fonttitle=\bfseries,
    coltitle=black,
    top=10pt,
    bottom=8pt,
    left=8pt,
    right=8pt,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={
        colback=androidGreen,
        colframe=androidGreen,
        arc=3pt,
        boxrule=0pt,
        left=6pt, right=6pt,
        top=3pt, bottom=3pt
    }
]

\begin{itemize}
    \item Cond (31-28): \texttt{0000} (EQ - Equal)
    \item Op (27-26): 00 (data-processing)
    \item Funct (25-20): \texttt{001000} (ADD operation, I=0, S=0)
    \item Rn (19-16): \texttt{0001} (R1)
   \item Rd (15-12): \texttt{0000} (R0)
    \item Src2 (11-0): \texttt{000000000010} (R2)
    \item This instruction adds R2 to R1 and stores the result in R0, but only if the Z flag is set (indicating equality)
\end{itemize}

\end{tcolorbox}


\end{document}